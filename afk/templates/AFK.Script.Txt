#Include "MathLib" as ML
#Include "TextLib" as TL
#Const TIMEOUT {{ afktimeout }} 
#Const TIMEOUT_FREQUENCE_CHECK {{ afktimeoutfrequencecheck }}
#Const TIMEOUT_SLEEP_DELAY {{ afktimeoutsleepdelay }}
#Const GRACE_PERIOD {{ afkgraceperiod }}

	Boolean isAfk(){
		declare endTime = GameTime + TIMEOUT;
		while(GameTime < endTime){
			yield;
			if (InputPlayer.RaceState != CTmMlPlayer::ERaceState::Running) {
				return False;
			}
			if (InputPlayer.Speed != 0) {
				return False;
			}
			sleep(TIMEOUT_SLEEP_DELAY);
		}
		return True;
	}

    main(){
        while(True){
			yield;
			if(InputPlayer == Null){
				sleep(GRACE_PERIOD);
				continue;
			}
			if (InputPlayer.RaceState == CTmMlPlayer::ERaceState::Running){
				if (isAfk()){
					TriggerPageAction("{{ id }}__Player_AFK");
					sleep(GRACE_PERIOD);
				} else {
					sleep(TIMEOUT_FREQUENCE_CHECK);
				}
			} else {
				sleep(GRACE_PERIOD);
			}
	   }
   }